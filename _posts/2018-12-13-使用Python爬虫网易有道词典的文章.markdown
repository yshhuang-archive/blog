---
title: ä½¿ç”¨Pythonçˆ¬è™«æ”¶é›†æœ‰é“è¯å…¸çš„æ–‡ç« 
tags: python çˆ¬è™« è‹±è¯­å­¦ä¹  
key: 20181213
---
## èµ·æº
ä¹‹å‰åœ¨æœ‰é“è¯å…¸ä¸Šçš„"æœ‰é“æ™¨è¯»"æ ç›®çœ‹è¿‡ä¸€äº›è¿è½½çš„åŒè¯­æ–‡ç« ,è¿˜æœ‰çœŸäººæœ—è¯»,è§‰å¾—å¾ˆä¸é”™,åƒ<å°ç‹å­>,<è€äººä¸æµ·>,<è¿½é£ç­çš„äºº>ç­‰.  
ä½†æ˜¯ä¸“æ çš„æ–‡ç« æ˜¯æŒ‰æ—¶é—´æ’åºçš„,åŒä¸€éƒ¨ä½œå“å¹¶ä¸è¿ç»­å‡ºç°,æƒ³è¦çœ‹ä¸€éƒ¨å®Œæ•´çš„è¿è½½ä½œå“å¾ˆä¸æ–¹ä¾¿,æ‰€ä»¥å°±æƒ³é€šè¿‡çˆ¬è™«çš„æ–¹æ³•æŠŠè¿™äº›æ–‡ç« æ•´ç†å‡ºæ¥,æ–¹ä¾¿æŸ¥çœ‹é˜²æ­¢ä¸¢å¤±(æœ‰é“è¯å…¸ä¸Šè¿‡è€çš„æ–‡ç« ä¼šä¸ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­,åªä¿ç•™æœ€æ–°500ç¯‡)

## ç¯å¢ƒ
æ‰‹æœº:Android 8.0.0  
ç”µè„‘:macOS 10.14.1,Charles 4.2.7,Python 3.7.0,mongoDB 4.0.0

## å‡†å¤‡å·¥ä½œ

1. è®¾ç½®æ‰‹æœºHTTPä»£ç†ï¼šç¡®ä¿ç§»åŠ¨è®¾å¤‡ä¸ Mac ç¬”è®°æœ¬åœ¨åŒä¸€å±€åŸŸç½‘å†…ï¼Œæ·»åŠ ä»£ç†ipåœ°å€ï¼ˆMacå†…ç½‘åœ°å€ï¼‰å’Œç«¯å£å·ï¼ˆ8888ï¼‰,å¦‚å›¾æ‰€ç¤ºï¼š
![wechatimg2](https://user-images.githubusercontent.com/9245002/51451163-f8d7a180-1d6e-11e9-827b-76d9c533b38f.jpeg)
2. åœ¨ Mac ä¸­æ‰“å¼€ Charles åº”ç”¨
3. åœ¨ç§»åŠ¨ç«¯è®¿é—®æ¥å£æ•°æ®ï¼Œåœ¨ Charles å¼¹å‡ºçš„ç¡®è®¤çª—ä¸­é€‰æ‹© Allowï¼Œå…è®¸å³å¯
4. è¿™é‡Œ,æˆ‘ä»¬æµè§ˆæœ‰é“æ™¨è¯»çš„ä¸“æ ä¸»é¡µ,åœ¨Charlesä¸­æ‰¾åˆ°è·å–æ–‡ç« åˆ—è¡¨çš„æ¥å£:http://dict.youdao.com/infoline/style?client=mobile&apiversion=3.0&lastId=0&style=morning&order=desc&size=10&keyfrom=mdict.7.8.5.android&model=MI_5s_Plus&mid=8.0.0&imei=99000828489816&vendor=xiaomi&screen=1080x1920&ssid=kkmh-2.4&network=wifi&abtest=0.
 ![wechatimg1](https://user-images.githubusercontent.com/9245002/51451162-f70dde00-1d6e-11e9-80dd-edcd3b71007f.jpeg)
![20190121105502](https://user-images.githubusercontent.com/9245002/51451159-efe6d000-1d6e-11e9-92b5-f2550bbde294.png)


## åˆ†æ(è¸©å‘)è¿‡ç¨‹
***è¿™ä¸€èŠ‚ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹ç»™è‡ªå·±çœ‹çš„,å«Œéº»çƒ¦å¯ç›´æ¥ç•¥è¿‡,ä»[ä¸‹ä¸€èŠ‚](#æ­£å¼å¼€å§‹)å¼€å§‹çœ‹***

ç»è¿‡åˆ†æ,æ¥å£ä¸­çš„å¾ˆå¤šå‚æ•°å¯¹äºæˆ‘è·å–æ•°æ®éƒ½æ˜¯æ— ç”¨çš„,ç®€åŒ–åçš„æ¥å£ä¸º
https://dict.youdao.com/infoline/style?style=morning&client=mobile&lastId=0&size=10  
è¿™æ˜¯ä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„æ¥å£,styleå’Œclientæ˜¯ä¸å˜çš„,lastIdè¡¨ç¤ºidçš„æœ€å¤§å€¼,sizeå³æ¯é¡µå¤§å°,é»˜è®¤10.å¦‚æ­¤,æŠŠæ¯æ¬¡è¿”å›æ–‡ç« åˆ—è¡¨(idä»å¤§åˆ°å°æ’åº)çš„æœ€åä¸€ç¯‡æ–‡ç« çš„idä½œä¸ºä¸‹ä¸€æ¬¡è¯·æ±‚çš„å‚æ•°,å³å¯éå†å…¨éƒ¨æ–‡ç« ,ä»£ç å¦‚ä¸‹
```python
import urllib.request
import json

def get_cards(last_id=0, size='10'):
    url = cardsUrl
    if last_id is not None:
        url = url + '&lastId=' + last_id
    if size is not None:
        url = url + '&size=' + size
    response = urllib.request.urlopen(url)
    result = response.read().decode('utf-8')

    card_list = json.loads(result)['cards']
    if len(card_list) > 0:
        last_id = card_list[-1]['id']
    return card_list, last_id

def save_articles():
    global cards
    card_list, lastId = get_cards(None, '10')
    cards = cards + card_list
    # insert_into_mysql(cards)
    while len(card_list) > 0:
        card_list, lastId = get_cards(lastId, '10')
        cards = cards + card_list
    print('æ–‡ç« åˆ—è¡¨ä¸‹è½½å®Œæˆ,å…±%dç¯‡æ–‡ç« ' % (len(cards)))
    insert_into_mysql()
```
å…¶å®ç”¨è¿™ç§æ–¹æ³•åªèƒ½è·å–åˆ°"æœ‰é“æ™¨è¯»"æ ç›®çš„æœ€æ–°500ç¯‡æ–‡ç« ,å†æ—§ç‚¹çš„æ–‡ç« é€šè¿‡è¿™ä¸ªæ¥å£å°±è·å–ä¸åˆ°äº†.ä¸è¿‡,é€šè¿‡åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ–‡ç« çš„è¯¦æƒ…é¡µ,æ‰¾åˆ°äº†ä¸€ä¸ªæ ¹æ®æ–‡ç« çš„pid(æœ‰é“è¯å…¸çš„æ–‡ç« ç¼–å·)è·å–æ–‡ç« è¯¦æƒ…çš„æ¥å£:http://xue.youdao.com/sw/m/1417209?showmethod=native .è¿”å›ç»“æœé‡Œæœ‰ä¸€ä¸ªrelatedå­—æ®µ,å°±æ˜¯é¡µé¢ä¸Šçš„ç›¸å…³é˜…è¯»,æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡é€’å½’çš„è®¿é—®æ–‡ç« çš„relatedå°±å¯ä»¥éå†æ‰€æœ‰çš„æ–‡ç« ?è¯•äº†ä¸€ä¸‹,ç»“æœå‘ç°åªæœ‰ä¸€éƒ¨åˆ†æ–‡ç« ä¼šå‡ºç°åœ¨relatedé‡Œ,æœ‰ä¸€äº›æ°¸è¿œä¸ä¼šå‡ºç°,è€Œä¸”æœ€æ–°çš„æ–‡ç« éƒ½ä¸å‡ºç°çš„relatedé‡Œçš„.  
![20190121142930](https://user-images.githubusercontent.com/9245002/51456621-5bd63200-1d89-11e9-9cce-c3fd6f624c56.png)
ä¸è¿‡,æˆ‘å‘ç°è¿™ä¸ªæ¥å£é‡Œçš„æ–‡ç« pidéƒ½æ˜¯æ•°å­—,æˆ‘åªè¦ä¸åœæ”¹å˜è¿™ä¸ªæ•°å­—åº”è¯¥å°±èƒ½è·å–æ‰€æœ‰æ–‡ç« äº†.è€Œä¸”å°äº1000000çš„pidæ˜¯æ²¡æœ‰æ–‡ç« çš„,åœ¨å½“æ—¶(2018-12-13)æœ€æ–°çš„æ–‡ç« pidåœ¨1600000~1700000.æ‰€ä»¥æˆ‘å…ˆçˆ¬å–1000000~1600000çš„æ—§æ•°æ®,å†ä»¥åæ¯æ¬¡æƒ³æ›´æ–°æ–‡ç« åº“çš„æ—¶å€™å¯ä»¥æ ¹æ®å·²ç»çˆ¬å–çš„æœ€å¤§pidæ¥çˆ¬å–æ–°çš„æ•°æ®.  
æˆ‘ä¸€å¼€å§‹æ˜¯ç”¨çš„MySQLæ¥å­˜å‚¨çˆ¬å–åˆ°çš„æ–‡ç« ,ä½†æ˜¯åæ¥å‘ç°æ–‡ç« çš„å­—æ®µæ ¼å¼ä¸å¤ªè§„èŒƒ,æ€»æ˜¯å‡ºç°ç©ºå­—æ®µæˆ–è€…å­—ç¬¦ä¸²è¿‡é•¿ç­‰é—®é¢˜,å†™äº†å¥½å¤šæ§åˆ¶åˆ¤æ–­ä¹‹ç±»çš„,å¥½éº»çƒ¦,åæ¥ç´¢æ€§ç”¨MongoDBæ¥å­˜å‚¨,æ–¹ä¾¿äº†å¾ˆå¤š,ç›´æ¥æ’å…¥ä¸€ä¸ªjsonå°±è¡Œäº†.

## æ­£å¼å¼€å§‹
é¦–å…ˆ,åˆ›å»ºMongoDBåº“,å¹¶æŠŠpidè®¾ä¸ºå”¯ä¸€ç´¢å¼•,ä½¿ç”¨pymongoè·å–æ•°æ®åº“è¿æ¥
```python
import pymongo

client = pymongo.MongoClient()
db = client['dish']
collection = db['youdao_dict']
```
æ ¹æ®pidè·å–æ–‡ç« ä¿¡æ¯
```python
articleUrl_suffix = '?showmethod=native&keyfrom=wap&client=wap'
articleUrl_prefix = 'http://xue.youdao.com/sw/m/'

def crawler_by_pid(pid):
    try:
        response = urllib.request.urlopen(articleUrl_prefix + str(pid) + articleUrl_suffix)
        result = response.read().decode('utf-8')
        article = json.loads(result)
        if article is None:
            return {}
        return article
    except:
        return crawler_by_pid(pid)
```
æ’å…¥æ–‡ç« 
```python
def insert_article(article):
    try:
        collection.insert_one(article).inserted_id
    except pymongo.errors.DuplicateKeyError:
        pass
```
ä¸€å¼€å§‹æ–‡ç« å¾ˆå¤š,å¯ä»¥å¼€å¯å¤šçº¿ç¨‹åˆ†åˆ«çˆ¬å–,å®Œæ•´ä»£ç å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://github.com/yshhuang/dish/blob/master/youdaocidian/save-to-mongodb.py)

## æˆæœ
æˆªæ­¢åˆ°2019-01-21æ›´æ–°,å·²ç»çˆ¬äº†30å¤šä¸‡ç¯‡æ–‡ç« ,è€Œä¸”ä¿¡æ¯å¾ˆè¯¦ç»†,åŒ…å«æ–‡ç« å†…å®¹(htmlæ ¼å¼),æ ç›®,æ ‡ç­¾,éŸ³è§†é¢‘é“¾æ¥(å¦‚æœæœ‰)ç­‰.
![20190121152842](https://user-images.githubusercontent.com/9245002/51458793-6694c500-1d91-11e9-9a44-e7a6b8257430.png)
![20190121152831](https://user-images.githubusercontent.com/9245002/51458799-698fb580-1d91-11e9-9a67-545f356c50b3.png)

æŸ¥ä¸€ä¸‹<å°ç‹å­>è¿è½½çš„æ–‡ç« ,çœ‹äº†ä¸€ä¸‹è¿˜ä¸é”™ğŸ¤”
![20190121154107](https://user-images.githubusercontent.com/9245002/51459344-32ba9f00-1d93-11e9-849f-658d6a856ffa.png)